<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Музыка для твоего текста</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #fff0f6;
    color: #d6336c;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px;
  }
  button {
    padding: 15px 30px;
    font-size: 18px;
    background-color: #d6336c;
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    margin-top: 30px;
  }
  button:hover {
    background-color: #a8325a;
  }
</style>
</head>
<body>

<h1>Музыка для твоего текста</h1>
<p>Нажми кнопку, чтобы начать музыку и почувствовать настроение песни.</p>
<button id="playBtn">Играть музыку</button>

<script>
  const AudioContext = window.AudioContext || window.webkitAudioContext;
  const ctx = new AudioContext();

  let isPlaying = false;
  let startTime = 0;
  let timer;

  const notes = {
    'A3': 220,
    'C4': 261.63,
    'E4': 329.63,
    'F4': 349.23,
    'G4': 392.00
  };

  // Аккорды для куплета: Am, F, C, G
  const chordProgression = [
    ['A3', 'C4', 'E4'],  // Am
    ['F4', 'A3', 'C4'],  // F
    ['C4', 'E4', 'G4'],  // C
    ['G4', 'B4', 'D5']   // G - не определены ноты B4 и D5, добавим их ниже
  ];

  // Добавим недостающие ноты
  notes['B4'] = 493.88;
  notes['D5'] = 587.33;

  function playNote(freq, duration, time) {
    const osc = ctx.createOscillator();
    const gainNode = ctx.createGain();

    osc.frequency.value = freq;
    osc.type = 'sine';

    osc.connect(gainNode);
    gainNode.connect(ctx.destination);

    gainNode.gain.setValueAtTime(0, time);
    gainNode.gain.linearRampToValueAtTime(0.15, time + 0.01);
    gainNode.gain.linearRampToValueAtTime(0, time + duration);

    osc.start(time);
    osc.stop(time + duration);
  }

  function playChord(chord, startTime) {
    chord.forEach(note => {
      playNote(notes[note], 1.8, startTime);
    });
  }

  function playProgression() {
    const now = ctx.currentTime;
    for(let i = 0; i < chordProgression.length; i++) {
      playChord(chordProgression[i], now + i * 2);
    }
  }

  document.getElementById('playBtn').addEventListener('click', async () => {
    if(ctx.state === 'suspended') {
      await ctx.resume();
    }
    if(!isPlaying) {
      playProgression();
      isPlaying = true;
      document.getElementById('playBtn').textContent = 'Музыка играет... Обнови страницу, чтобы запустить заново';
      document.getElementById('playBtn').disabled = true;
    }
  });
</script>

</body>
</html>
